package connection

import (
	"encoding/json"
	"fmt"
	"os"
	"testing"

	"github.com/project-flogo/core/support/log"
)

var connectionLog = log.ChildLogger(log.RootLogger(), "SFTP-connection")

var sshUserPasswordConnectionJSON = []byte(`{
	"name": "sshUserPassword",
	"description": "",
	"host": "192.168.0.214",
	"port": 22,
	"user": "tibco",
	"password": "tibco123",
	"publicKeyFlag": false,
	"hostKeyFlag": false
}`)

var sshUserPasswordHostKeyConnectionJSON = []byte(`{
	"name": "sshUserPasswordHostKey",
	"description": "",
	"host": "192.168.0.214",
	"port": 22,
	"user": "tibco",
	"password": "tibco123",
	"publicKeyFlag": false,
	"hostKeyFlag": true,
	"knownHostFile": {
		"filename": "knownhost",
        "content": "data:application/octet-stream;base64,fDF8dTcyWERWb2g1REV3R0RWNGV5ZUhEdXVFTTIwPXxMREtFWGtoOUJqVkRGSDk0TzhKSEcvV25SN0k9IHNzaC1lZDI1NTE5IEFBQUFDM056YUMxbFpESTFOVEU1QUFBQUlGYlYzREcxZFBNUzc4ZXl5TDROa2cwRHY5M0ZFSVNQUWp4Y1UvVnpOdVQwCnwxfHdXQVpXajZURG9TVmxLWktQbWNLdkVlOWUwND18QVR2a01YRHZjTTI2UWhSOUpWQXEzbWNmRlI4PSBzc2gtcnNhIEFBQUFCM056YUMxeWMyRUFBQUFEQVFBQkFBQUJnUURCdnVKeFBOT0NiWDhKdHFiQkRXRitXamFOcUxoYUs3M05FQjZRSGw1RkpGck5MZFViTUpVLzVkVmhVVXpVbWFLVXNtUUZKS3VaSWVRa1JNVExZZHV4NDB0VkZJcHFxOXkxOXRDN3JNbERRcWl1Nzc3RHVnWlJqaXRSdG9iazZqMUgxeDBLdUlWNTNrMTlhVFBDY1ZMYkYreXUxbFhKbU1ncHNIMXMxMlFFTS9taEdSTHptbk4ycGNrZ3I2RW9GeXQ3cE9wTU9zUFR6d2JoeW1tU0xEbmtma0NEUHlPaG01cWVOb2cvaDN5NUg1eTFDZEQ1UVJ0K2VTL2Q1UmZSRnpiYU1NWnFaQzJqeTRtUldQdFFiZlhZTHY4NjJuSkhhV2x4Y25JcmgzNVlDOG9kSzk4S3djcnZadU9zUDZLTzBTNEVVTFU1Nk1IbDQxL1lmRTNlNVBab0c4SlBNaERndEJvaTkvdktFSnFkVHE4eFlTSFdTYWtwVytRL21hK1p5V3l5eVA1cDVpcFVKcmtsaWpldlg2b0g1UjBSNWVva2pvUXJnYXdQTXJFWFRGWVNrY0tMK1ExZy9qVWxaSjQ2TitGOWs4Tm1Ed1lEeVlwWVlXclAwUi85ekExbkFkUlJ2OEltTFB3ei9yL0tYQ240cHRtUnBMTG9BWWpkUlhnYktKcz0KfDF8MVJpM25PcUg1WkVERkVIZnJFbWZOcWZDUFljPXxpaHR0TnFuSnBDT1Z2K29ROEdodzV2MVp0c3c9IGVjZHNhLXNoYTItbmlzdHAyNTYgQUFBQUUyVmpaSE5oTFhOb1lUSXRibWx6ZEhBeU5UWUFBQUFJYm1semRIQXlOVFlBQUFCQkJFTTIvVkFqSk1EMDRUVjJhbnpDbGd2ZkhQbnAxa1pKUk9KU0dPQUxERlV6c2h1S1RVTmpHRUlCa3NBU3diOWJOaTYrT1lHT1VPOEhuTDJacDQzZHNZdz0K"
		}
}`)

var sshPrivateKeyConnectionJSON = []byte(`{
	"name": "sftpPrivateKey",
	"description": "",
	"host": "192.168.0.214",
	"port": 22,
	"user": "tibco",
	"publicKeyFlag": true,
	"privateKey": {
		"filename": "id_rsa",
		"content": "data:application/octet-stream;base64,LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQ21GbGN6STFOaTFqZEhJQUFBQUdZbU55ZVhCMEFBQUFHQUFBQUJCbUdzRGM0cgpTYnRiZnE2S1lYMEpQZ0FBQUFFQUFBQUFFQUFBR1hBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCZ1FDMnRscVFiOEpjCnprQjFhY1RIS3htb0xkdjFhb0diRkZ3MXVkdzVGVmNCem42dTE4MWFMQWYxQXBLdVBiU0creGZVMHA4VXVRYWxXU2xLcjMKK3lQQi9iTFU4TGtwZk5ZVklZdXRvOUJ5NlV4cTBjTndrc2tKTkxQelRzSU1XTWdHUUpBbVRzeUtXWGIxVnVMWkNjVVk4Swo3dTdZMDZyeStRR0lVazY5dDRHaHJJeXNSRFNveVozRWN1RlRQZjIyU3Qra1hIMUJKZktKZ2cremhlTERIR2puRmNXZ2l1Cno3cmozZWN2ZUZscmJwZHNheFkxN3hwcVlXWUpKcVJPUmUwZ0JrRUhUNlh3SGRnRFJwNHR1amhoQ2duUFJTSkhpN2IwZ3MKT1JzSERiMWZSTGZiYU9QWDE2L1QxWUhrejlSRlAwZ1Mxc0hyMmdMRzdXSEpBcGhtWThvbkpPRmROL0VwTTVlb0FFSWlTQQpZOCtNSUxNdW9PU1YyVVpwQWI5dHVZSE9iQy9IRzhnR1NWcmRSZWpVMTR1VllpUDBzNzAxbGZIclBQcHVXaFowMkM4em9qCmpmbXZzS2krd2xqNmFwMkhrVWlIYUlBdDJ2aUdxaUpxQ1cyRGR2MVJxREdReDJBTUwwNXV6YkNZdnl2OHlCRGd3b0Q0M1gKbmw0Z3MvRWoxb0ZLOEFBQVdRRTdENXF1UTJqaGx2K1UxZ1FUejNsVnZIUXFxUTNyZERiYWhvd3Q0ZStxdkhsMkxlN0ZkMQpYbDZjMHhkbTVZejZ0K1hLei8xSkN1NCt2NjNxdDIzZ2VRMzBuUXEzeVh5UmdlYXNmeC84UUNkZ1M2NGJaUFcrUnUvVlpXCjYyYmVSMk5qNzhkMkViUG5VQkJVMnFSUGUvQzJabW1QRUZZYUh4bWhDRVZGYmFhaWFxdHYzNUlTaXhMR3crS1k2bVpjSW0KTGhhendIZk8ycUhLUFc5N3JvNTN6SCtuaEl1Mm5LdmE4SlpHODJZdmhISGdLZXN6c2hJck44bGVBVnNyWGJsWGVRNTVMMgo3d2J3bzd5blJpdWZnbGRIb2VrOXVwMktqcGJ4cE96OExMZXAwM0NDMEVpcEx2VUlGRENDa1dpRi9BRThDbFVRMGdZVldlCkFFdlV2UzMrRnMza2NEYlRUYndTT1lvaWVERzh5MXgrSENLWS94ZlhteWtoUUo5L2ZXVGk3Z0V4QWdVYm5PU3NQcENXV3IKWlUzUFFlY0FmZmxXMUxUcEYvWW50OTMzT1ovcy9MTmEzWmtFa3NHZzMxT2YzeUFRM1orNGZBOXpwUjRYK1BITzYxNGVUYgpQSFFQUi9nRVEvR0pUdzVldm5YZ0lNdnhTaGtUWGI1ZEhYY2IvaWtoV3c2TklVYk5vZG9LUy9QamtRd2NYTTNhY1A0YzZ0Cm11M3NoSlJFNXdTam1maWQ4NmlpZ2trcUxreUhEYkkvYjRCeHIwYUFXSk9ybHFCdnExYms1NWRicCtKQ0t5U3dPMElGeGQKYWYyZFZScURhMHRoRzRzdUNKdzFxZlY3cGFCcnhucW5jRGVCNXFTdnVxa0FGZVRYVCtCaGh5aHpLU0Z3L1I4Vmg1dFFoego1U3pBNFFTRmtldTBXOVM5RXVjNjMzbzdDSTZJM1VlREpnR3lraHEwRThuaFFnd1RoSHJKc1ZSWTdyY3gwVTZydW4vdkVhCjZOeXlUMnVtMkJOZ2s4UXhXWTdEOGpTdHdsd1BSME95SXRQSk1JSEEwdVdIc3BZZEJIdUZ6QTErZkxvTjAwd0w0a0lBVjkKNDR5OGJFaFJ0UTBuaTVHbTVOK1lzQ0xnNzBqUVRReERvRDh1M2xSSVBiUWVHRzU1cVk5Nld2SEFTZXJXOXNGQWVqSjZ2MAozdkx6Y2wwM2VqaFIyb2w5djU1YkRoRGE4dFpqTjk2NnVmL2R5cHlRNFhRbUUwbnN3MTJiU2JKRzd5TzZsQ0oya05WOEltCnNvNExZVWpkMUw0bUp0a2hIT1N6My9LeW5zNG5QTnhnVVVybUJlSm5GVEpNeGNjdmpaa2Z5K1dZY0luWEhsdy80MStmYWwKRG1senpLOXU5Z2ZDWVFOU2ErY0JKK25tdlBhSndTQm1YUHJkbHNDbjNvdHd0ZXFHMHpqVktkS3FxdVlxczNiQUVoMGx0SApsaFNUSkhQb3lJbXF3YkUwK0FRTk1sU2hDaEFGQUN1Mm5TZ3FBZFBlZ2N2bUVqcDFlVUQxT1REUDlJalBDemlUUjlzcWtrCmdMSDJTSVdmTW1iV2FaMEIvejZtTDEzUUtENFd1WGVIV3dpQ2lPbitXWVpEQ1kvcXhXdUM2THlEQTVtTjFaT2ZmU2hNY1oKNEFKd3lnUVhqT0FCZmxSRmZsQ2xsRFpWQmZhWSs2MnlOclYwcXBubGQwUTR3ZWhIMU5NYU8rekpUTFkwSUJkM1F4bS9aeQovYTh6a1hxVDV4K2hnai9rdzFoYi9JejR2Yk04TkV6ZllQUlJiWFREbmxLRkFnM2M2S0lsR09XVFBEMW1kU2UwQUE1K2NuCnc0c2pNbWhpalFUZUNieThucFNqN2lSSzhCVHFuMlZUdC8xZTRXSGkwZ1lJY1UxSEovU3NlNExWV2h5VXhNOWU4Y3NBMkwKNlJZSVhmejRaRG1wTnNWdndGNG4xSzFkcUNTU2JwNTJSQ3dGTG1WNGxyYkdIOTQ2UEJYcDZoaW43c081SFcrS1RQeXZQbgpVbVZ5b3JIMGI1NnhZTENxUTBNK1hrN2hMbkVvZjhuQ0NLZkthWU1qbzVXdUViZEIzaytDRHRKcG95UzJtK0dRbEVmU3hDCmsxK0hRWmlXajZSWUlaN0VZbk1BMVpqRHNKYWRxNzJKbXo0OERTUm9MN2xFSVh6OHprNFgvVGI1YjlvNjAyamdtNVVoS1EKenpGcGRWa0xwTzlxK2VvT3E2ZTRhMkUxRTNqbU1UUmFBaFV5TXFOSURLdk0zdUJMZ0lzREdQSnV0VUJEekhJOCtjRElDUgpDSWlwWTlacjRjRVArMVNhNlJBMXJNRGtHcUZDcWJjMjcwOUp1VUE5NWxYY0cwV3dsdmYzVjI1QjY1bzhrVjVIM04vcFE2CktnSWxaN3djeFJvaTBVaUtubUFvamE4UDJEbFNya0JETWp3eGJYL3RWaGJITEprK0IzM1lYTVRMdE9zWWk1czVqM1Y3R04Ka3NhZHV3ZEFUbjUxZktFU3BLcHFRVGZGWCtnPQotLS0tLUVORCBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0K"
	},
	"privateKeyPassword": "tibco123",
	"hostKeyFlag": false
}`)

var sshPrivateKeyWithoutPasswordConnectionJSON = []byte(`{
	"name": "sftpPrivateKeyWithoutPassword",
	"description": "",
	"host": "192.168.0.214",
	"port": 22,
	"user": "tibco",
	"publicKeyFlag": true,
	"privateKey": {
		"filename": "id_rsa_withoutpassword",
		"content": "data:application/octet-stream;base64,LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUJsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFZRUF3UTQydEM4b1dzbWxLNnBNVGZJdlVMUW1MWXp1Q3FVZE1GWjd2SFNGU1FmREMzMDJOTUhGCkZVclpUZis4UVFvNTZhbU5Pd04vdlcvNlI3c2dMUm5iaWQzMVN4ZUk1QzJQdFN4NEJleFh5WGJ0R21EU3ZzRTZGc2JyOWMKck9FWFVMTUptNlhtZkU1b1BPbnZGUTFxaWxwRVJML0xJSjBCOUljQlRORTd5L3ZwN1kxeUV2QkNqOG1Dd1RMcDRLOVVrcQprVlpEeElmR1NMMEVDYTlQaE5iZW5taktkaWFjV0pKRmovOEZPN0lpR2xET1orUWhGL2ZtZHhvVGZlTGN5cStjdHR3czBmClpTZFlETGdtZU9mNFFxZklYeE1oTXpRSE44LzJSRkZnYVNEaUwrRndjMENHbnZ2VDRsRGpndks2MWROWjhLT2Vad1N0UjAKeWJwc2thY25uYnFHMnd5Z3FIMy9ZZjdYUmFNMWFCQ2JFZW93NHV0OGNpR0xrd1FPenRIeVRidEtOcHBVKzVHdEZETzBxNApOeVZPQXZIMmJ3YTc4eFRmQUkxV1lodVNjcWhQSGF2U053Z3NuZGxQamVZUVJnbEZkTUU1OGxZUXVMZzJuWm9hRDl5Y3oxClVBcForODBnZFBSL0pvWk1TOENEa1ZiUTh1YjBXS21KQzMzQ213QlZBQUFGaUdEUEgzOWd6eDkvQUFBQUIzTnphQzF5YzIKRUFBQUdCQU1FT05yUXZLRnJKcFN1cVRFM3lMMUMwSmkyTTdncWxIVEJXZTd4MGhVa0h3d3Q5TmpUQnhSVksyVTMvdkVFSwpPZW1walRzRGY3MXYra2U3SUMwWjI0bmQ5VXNYaU9RdGo3VXNlQVhzVjhsMjdScGcwcjdCT2hiRzYvWEt6aEYxQ3pDWnVsCjVueE9hRHpwN3hVTmFvcGFSRVMveXlDZEFmU0hBVXpSTzh2NzZlMk5jaEx3UW8vSmdzRXk2ZUN2VkpLcEZXUThTSHhraTkKQkFtdlQ0VFczcDVveW5ZbW5GaVNSWS8vQlR1eUlocFF6bWZrSVJmMzVuY2FFMzNpM01xdm5MYmNMTkgyVW5XQXk0Sm5qbgorRUtueUY4VElUTTBCemZQOWtSUllHa2c0aS9oY0hOQWhwNzcwK0pRNDRMeXV0WFRXZkNqbm1jRXJVZE1tNmJKR25KNTI2Cmh0c01vS2g5LzJIKzEwV2pOV2dRbXhIcU1PTHJmSEloaTVNRURzN1I4azI3U2phYVZQdVJyUlF6dEt1RGNsVGdMeDltOEcKdS9NVTN3Q05WbUlia25Lb1R4MnIwamNJTEozWlQ0M21FRVlKUlhUQk9mSldFTGk0TnAyYUdnL2NuTTlWQUtXZnZOSUhUMApmeWFHVEV2QWc1RlcwUExtOUZpcGlRdDl3cHNBVlFBQUFBTUJBQUVBQUFHQU05empxVWc1NlJuZXUzcEdnWEljYit2VmpjCnNjYjlPbm9jSzUvd2kyZmNZT0Nkb2JZOVRpWXpQMmFOUFkrUWdNUXM5LzEyaTdPbU1JczVoN3JtSVI3bG1vZWdIYWpxSUcKeHo4cEJ6NVUzeFNKNGRvOUEyM1pjeUVCWnNpU3ozSElEY2hlbnRuMXRZK1hSRy9EcmNja3FKcUlaMXhVOG9wVTVYZFJHSQpwT1lLRS8wNXRnakJlT3REcXk5SVVVb0l5RldRSDV0cVJiQ2xOczhFVWVjYXRmcHVLejhVV3lIc0U4MnRCQjBhV3JMN0toCm9KdFNvS1BDVUNDN044aG9WRE1VeUhxK2VlWmNuMmR5ZVAyNGRJOVkzYS8yeCsyVDd0R2pjN21nUzRzaHg0a0d6WGhJYVYKc21VNlRQRk4rTVlsS1A3cDdNY1RqTE9EaTgvTm9xcUlqVnFNS3hSdnJSSDVhNlVCcE0wTks0VEg1ZWhFREdLN1hTU1M2TApqTWV3SzVVbTIyK2R3aGl6OG8zMzFrcXZ2b2xjT1FDSUx0V1c5akNSRm95eDJYVFYvSkM5QzN4Y2RPUzVFaHlRTzdqdWcyCnpiSFY3UU5VR1RPUHVZdUEwUnhQdGRGNld2MXF0ZkpBTjF3eGMvT0VSZ2YzVUQzRDRSaXdaVFlma3JhVHdDMEFwSkFBQUEKd0Y1eW9RN0tlemtlbzZvR0NLSG9WWGdpemVscmxraDhjcWx5RDdOQzl6TEQvZXNUZG9STktHS28ybWFacEdtTUJIQUpxTQprY21halNIdDdEYUlYVmc0R3hyUTd5SFN4Z0xwMXJiYXJxTVFmTElxRzBTZmh4ZTB0ZktMdEIyRmJPWS8zRVBiNDhyUlBGCnBNRXcvSndzREJvS250YjBCcEVWMEZkUXJpbXcwMVM4c1dzbmxCVVI4d21OaWxjWVNITU9wS00xeFljS2w3SlptQjcvejIKNEd3NnJ5Rmw3dG5GZDdTdmlkQjQxWE9WZktIR0xleE1vK1lWVGVuQkQ0V1U5dlNnQUFBTUVBK1JxMkpHb1ZJZ1BRWTNncwp1S2RGQUNCc1JtbWNmc1U5akcrUUorck8rblRFSW1QRzVBc3FLSGlPaHBUVlQvN29HeG9xbnAzeGZxTXJ2aWJtLytReDZhCmljaFVLVEh4ZEFjVUozQ0dzWnlBbzA4Q25HTnNwTXNtd1BLbEx5WjFpcW1ZV2VLeEx1M09lbkxUSms1REhWZC9iUllRNzQKbzYwTEZ0dWFSN2VKZjAzSnl2U0ttY2JYSFpYZHdSd1pDZjNPUFJGakpxUHMyNmVadm5CUkxXZkNzOEtIU1d2SVIxWlFNbQptZHRuUXNUV3FwZHFSRCtNQ1lzZWdSS1NvcGs4ekhBQUFBd1FER1prOVNiTVF0bUR0TDFWVmE2c2JDNStsZUxaNWV1V2szCjlzVnVYU3pPUUtUditEcHVHTTY2Nk5wTERaK3UrR0NyNmRQRk16T2J4ZlY0N3Q5Tm1tT1R5UE5hNElmdXg2VXBtLzdVbnkKQWs0dWZMZ2ZrLzNIZmE2cW9hNGRZK0N3NkZyRldQOVFFcFR4dzBKajUxSmlBb2lrL3dkQmVaYm96VFpMQ0pPUC9LeHp5cApyd2NnYUVwUDNPMENEaDR0WEoxTkdJVkRuZVNWenl1ZDNTY1BuYXpzYWgwZUNvVkVhQU81ckRQeWw1aDZmVHpRNUJRb3B2Cm95VmlPbzN2UUZsZ01BQUFBUWJXMTFjM05sZEhSQVJuSmhZM1JoYkFFQ0F3PT0KLS0tLS1FTkQgT1BFTlNTSCBQUklWQVRFIEtFWS0tLS0tCg=="
	},
	"hostKeyFlag": false
}`)

var sshPrivateKeyHostKeyConnectionJSON = []byte(`{
	"name": "sshPrivateKeyHostKey",
	"description": "",
	"host": "192.168.0.214",
	"port": 22,
	"user": "tibco",
	"publicKeyFlag": true,
	"privateKey": {
		"filename": "id_rsa",
		"content": "data:application/octet-stream;base64,LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQ21GbGN6STFOaTFqZEhJQUFBQUdZbU55ZVhCMEFBQUFHQUFBQUJCbUdzRGM0cgpTYnRiZnE2S1lYMEpQZ0FBQUFFQUFBQUFFQUFBR1hBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCZ1FDMnRscVFiOEpjCnprQjFhY1RIS3htb0xkdjFhb0diRkZ3MXVkdzVGVmNCem42dTE4MWFMQWYxQXBLdVBiU0creGZVMHA4VXVRYWxXU2xLcjMKK3lQQi9iTFU4TGtwZk5ZVklZdXRvOUJ5NlV4cTBjTndrc2tKTkxQelRzSU1XTWdHUUpBbVRzeUtXWGIxVnVMWkNjVVk4Swo3dTdZMDZyeStRR0lVazY5dDRHaHJJeXNSRFNveVozRWN1RlRQZjIyU3Qra1hIMUJKZktKZ2cremhlTERIR2puRmNXZ2l1Cno3cmozZWN2ZUZscmJwZHNheFkxN3hwcVlXWUpKcVJPUmUwZ0JrRUhUNlh3SGRnRFJwNHR1amhoQ2duUFJTSkhpN2IwZ3MKT1JzSERiMWZSTGZiYU9QWDE2L1QxWUhrejlSRlAwZ1Mxc0hyMmdMRzdXSEpBcGhtWThvbkpPRmROL0VwTTVlb0FFSWlTQQpZOCtNSUxNdW9PU1YyVVpwQWI5dHVZSE9iQy9IRzhnR1NWcmRSZWpVMTR1VllpUDBzNzAxbGZIclBQcHVXaFowMkM4em9qCmpmbXZzS2krd2xqNmFwMkhrVWlIYUlBdDJ2aUdxaUpxQ1cyRGR2MVJxREdReDJBTUwwNXV6YkNZdnl2OHlCRGd3b0Q0M1gKbmw0Z3MvRWoxb0ZLOEFBQVdRRTdENXF1UTJqaGx2K1UxZ1FUejNsVnZIUXFxUTNyZERiYWhvd3Q0ZStxdkhsMkxlN0ZkMQpYbDZjMHhkbTVZejZ0K1hLei8xSkN1NCt2NjNxdDIzZ2VRMzBuUXEzeVh5UmdlYXNmeC84UUNkZ1M2NGJaUFcrUnUvVlpXCjYyYmVSMk5qNzhkMkViUG5VQkJVMnFSUGUvQzJabW1QRUZZYUh4bWhDRVZGYmFhaWFxdHYzNUlTaXhMR3crS1k2bVpjSW0KTGhhendIZk8ycUhLUFc5N3JvNTN6SCtuaEl1Mm5LdmE4SlpHODJZdmhISGdLZXN6c2hJck44bGVBVnNyWGJsWGVRNTVMMgo3d2J3bzd5blJpdWZnbGRIb2VrOXVwMktqcGJ4cE96OExMZXAwM0NDMEVpcEx2VUlGRENDa1dpRi9BRThDbFVRMGdZVldlCkFFdlV2UzMrRnMza2NEYlRUYndTT1lvaWVERzh5MXgrSENLWS94ZlhteWtoUUo5L2ZXVGk3Z0V4QWdVYm5PU3NQcENXV3IKWlUzUFFlY0FmZmxXMUxUcEYvWW50OTMzT1ovcy9MTmEzWmtFa3NHZzMxT2YzeUFRM1orNGZBOXpwUjRYK1BITzYxNGVUYgpQSFFQUi9nRVEvR0pUdzVldm5YZ0lNdnhTaGtUWGI1ZEhYY2IvaWtoV3c2TklVYk5vZG9LUy9QamtRd2NYTTNhY1A0YzZ0Cm11M3NoSlJFNXdTam1maWQ4NmlpZ2trcUxreUhEYkkvYjRCeHIwYUFXSk9ybHFCdnExYms1NWRicCtKQ0t5U3dPMElGeGQKYWYyZFZScURhMHRoRzRzdUNKdzFxZlY3cGFCcnhucW5jRGVCNXFTdnVxa0FGZVRYVCtCaGh5aHpLU0Z3L1I4Vmg1dFFoego1U3pBNFFTRmtldTBXOVM5RXVjNjMzbzdDSTZJM1VlREpnR3lraHEwRThuaFFnd1RoSHJKc1ZSWTdyY3gwVTZydW4vdkVhCjZOeXlUMnVtMkJOZ2s4UXhXWTdEOGpTdHdsd1BSME95SXRQSk1JSEEwdVdIc3BZZEJIdUZ6QTErZkxvTjAwd0w0a0lBVjkKNDR5OGJFaFJ0UTBuaTVHbTVOK1lzQ0xnNzBqUVRReERvRDh1M2xSSVBiUWVHRzU1cVk5Nld2SEFTZXJXOXNGQWVqSjZ2MAozdkx6Y2wwM2VqaFIyb2w5djU1YkRoRGE4dFpqTjk2NnVmL2R5cHlRNFhRbUUwbnN3MTJiU2JKRzd5TzZsQ0oya05WOEltCnNvNExZVWpkMUw0bUp0a2hIT1N6My9LeW5zNG5QTnhnVVVybUJlSm5GVEpNeGNjdmpaa2Z5K1dZY0luWEhsdy80MStmYWwKRG1senpLOXU5Z2ZDWVFOU2ErY0JKK25tdlBhSndTQm1YUHJkbHNDbjNvdHd0ZXFHMHpqVktkS3FxdVlxczNiQUVoMGx0SApsaFNUSkhQb3lJbXF3YkUwK0FRTk1sU2hDaEFGQUN1Mm5TZ3FBZFBlZ2N2bUVqcDFlVUQxT1REUDlJalBDemlUUjlzcWtrCmdMSDJTSVdmTW1iV2FaMEIvejZtTDEzUUtENFd1WGVIV3dpQ2lPbitXWVpEQ1kvcXhXdUM2THlEQTVtTjFaT2ZmU2hNY1oKNEFKd3lnUVhqT0FCZmxSRmZsQ2xsRFpWQmZhWSs2MnlOclYwcXBubGQwUTR3ZWhIMU5NYU8rekpUTFkwSUJkM1F4bS9aeQovYTh6a1hxVDV4K2hnai9rdzFoYi9JejR2Yk04TkV6ZllQUlJiWFREbmxLRkFnM2M2S0lsR09XVFBEMW1kU2UwQUE1K2NuCnc0c2pNbWhpalFUZUNieThucFNqN2lSSzhCVHFuMlZUdC8xZTRXSGkwZ1lJY1UxSEovU3NlNExWV2h5VXhNOWU4Y3NBMkwKNlJZSVhmejRaRG1wTnNWdndGNG4xSzFkcUNTU2JwNTJSQ3dGTG1WNGxyYkdIOTQ2UEJYcDZoaW43c081SFcrS1RQeXZQbgpVbVZ5b3JIMGI1NnhZTENxUTBNK1hrN2hMbkVvZjhuQ0NLZkthWU1qbzVXdUViZEIzaytDRHRKcG95UzJtK0dRbEVmU3hDCmsxK0hRWmlXajZSWUlaN0VZbk1BMVpqRHNKYWRxNzJKbXo0OERTUm9MN2xFSVh6OHprNFgvVGI1YjlvNjAyamdtNVVoS1EKenpGcGRWa0xwTzlxK2VvT3E2ZTRhMkUxRTNqbU1UUmFBaFV5TXFOSURLdk0zdUJMZ0lzREdQSnV0VUJEekhJOCtjRElDUgpDSWlwWTlacjRjRVArMVNhNlJBMXJNRGtHcUZDcWJjMjcwOUp1VUE5NWxYY0cwV3dsdmYzVjI1QjY1bzhrVjVIM04vcFE2CktnSWxaN3djeFJvaTBVaUtubUFvamE4UDJEbFNya0JETWp3eGJYL3RWaGJITEprK0IzM1lYTVRMdE9zWWk1czVqM1Y3R04Ka3NhZHV3ZEFUbjUxZktFU3BLcHFRVGZGWCtnPQotLS0tLUVORCBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0K"
	},
	"privateKeyPassword": "tibco123",
	"hostKeyFlag": true,
	"knownHostFile": {
		"filename": "knownhost",
        "content": "data:application/octet-stream;base64,fDF8dTcyWERWb2g1REV3R0RWNGV5ZUhEdXVFTTIwPXxMREtFWGtoOUJqVkRGSDk0TzhKSEcvV25SN0k9IHNzaC1lZDI1NTE5IEFBQUFDM056YUMxbFpESTFOVEU1QUFBQUlGYlYzREcxZFBNUzc4ZXl5TDROa2cwRHY5M0ZFSVNQUWp4Y1UvVnpOdVQwCnwxfHdXQVpXajZURG9TVmxLWktQbWNLdkVlOWUwND18QVR2a01YRHZjTTI2UWhSOUpWQXEzbWNmRlI4PSBzc2gtcnNhIEFBQUFCM056YUMxeWMyRUFBQUFEQVFBQkFBQUJnUURCdnVKeFBOT0NiWDhKdHFiQkRXRitXamFOcUxoYUs3M05FQjZRSGw1RkpGck5MZFViTUpVLzVkVmhVVXpVbWFLVXNtUUZKS3VaSWVRa1JNVExZZHV4NDB0VkZJcHFxOXkxOXRDN3JNbERRcWl1Nzc3RHVnWlJqaXRSdG9iazZqMUgxeDBLdUlWNTNrMTlhVFBDY1ZMYkYreXUxbFhKbU1ncHNIMXMxMlFFTS9taEdSTHptbk4ycGNrZ3I2RW9GeXQ3cE9wTU9zUFR6d2JoeW1tU0xEbmtma0NEUHlPaG01cWVOb2cvaDN5NUg1eTFDZEQ1UVJ0K2VTL2Q1UmZSRnpiYU1NWnFaQzJqeTRtUldQdFFiZlhZTHY4NjJuSkhhV2x4Y25JcmgzNVlDOG9kSzk4S3djcnZadU9zUDZLTzBTNEVVTFU1Nk1IbDQxL1lmRTNlNVBab0c4SlBNaERndEJvaTkvdktFSnFkVHE4eFlTSFdTYWtwVytRL21hK1p5V3l5eVA1cDVpcFVKcmtsaWpldlg2b0g1UjBSNWVva2pvUXJnYXdQTXJFWFRGWVNrY0tMK1ExZy9qVWxaSjQ2TitGOWs4Tm1Ed1lEeVlwWVlXclAwUi85ekExbkFkUlJ2OEltTFB3ei9yL0tYQ240cHRtUnBMTG9BWWpkUlhnYktKcz0KfDF8MVJpM25PcUg1WkVERkVIZnJFbWZOcWZDUFljPXxpaHR0TnFuSnBDT1Z2K29ROEdodzV2MVp0c3c9IGVjZHNhLXNoYTItbmlzdHAyNTYgQUFBQUUyVmpaSE5oTFhOb1lUSXRibWx6ZEhBeU5UWUFBQUFJYm1semRIQXlOVFlBQUFCQkJFTTIvVkFqSk1EMDRUVjJhbnpDbGd2ZkhQbnAxa1pKUk9KU0dPQUxERlV6c2h1S1RVTmpHRUlCa3NBU3diOWJOaTYrT1lHT1VPOEhuTDJacDQzZHNZdz0K"
		}
}`)

func TestSshUserPassword(t *testing.T) {
	//set logging to debug level
	log.SetLogLevel(connectionLog, log.DebugLevel)

	conn := make(map[string]interface{})
	err := json.Unmarshal([]byte(sshUserPasswordConnectionJSON), &conn)
	if err != nil {
		fmt.Println(err)
		os.Exit(1)
	}

	sdb := SshFactory{}
	s, err := sdb.NewManager(conn)
	if err != nil {
		fmt.Println(err)
		os.Exit(1)
	}
	s.(*SshSharedConfigManager).Stop()
}

func TestSshpUserPasswordWithStrictHostKey(t *testing.T) {
	//set logging to debug level
	log.SetLogLevel(connectionLog, log.DebugLevel)

	conn := make(map[string]interface{})
	err := json.Unmarshal([]byte(sshUserPasswordHostKeyConnectionJSON), &conn)
	if err != nil {
		fmt.Println(err)
		os.Exit(1)
	}

	sdb := SshFactory{}
	s, err := sdb.NewManager(conn)
	if err != nil {
		fmt.Println(err)
		os.Exit(1)
	}
	s.(*SshSharedConfigManager).Stop()
}

func TestSshpPrivateKey(t *testing.T) {
	//set logging to debug level
	log.SetLogLevel(connectionLog, log.DebugLevel)

	conn := make(map[string]interface{})
	err := json.Unmarshal([]byte(sshPrivateKeyConnectionJSON), &conn)
	if err != nil {
		fmt.Println(err)
		os.Exit(1)
	}

	sdb := SshFactory{}
	s, err := sdb.NewManager(conn)
	if err != nil {
		fmt.Println(err)
		os.Exit(1)
	}
	s.(*SshSharedConfigManager).Stop()
}

func TestSshPrivateKeyWithoutPassword(t *testing.T) {
	//set logging to debug level
	log.SetLogLevel(connectionLog, log.DebugLevel)

	conn := make(map[string]interface{})
	err := json.Unmarshal([]byte(sshPrivateKeyWithoutPasswordConnectionJSON), &conn)
	if err != nil {
		fmt.Println(err)
		os.Exit(1)
	}

	sdb := SshFactory{}
	s, err := sdb.NewManager(conn)
	if err != nil {
		fmt.Println(err)
		os.Exit(1)
	}
	s.(*SshSharedConfigManager).Stop()
}

func TestSshPrivateKeyWithStrictHostKey(t *testing.T) {
	//set logging to debug level
	log.SetLogLevel(connectionLog, log.DebugLevel)

	conn := make(map[string]interface{})
	err := json.Unmarshal([]byte(sshPrivateKeyHostKeyConnectionJSON), &conn)
	if err != nil {
		fmt.Println(err)
		os.Exit(1)
	}

	sdb := SshFactory{}
	s, err := sdb.NewManager(conn)
	if err != nil {
		fmt.Println(err)
		os.Exit(1)
	}
	s.(*SshSharedConfigManager).Stop()
}
